# 📊 CSV数据管理指南

## 🎯 问题说明

您遇到的问题是新增图片的CSV记录中很多字段显示为NULL，这是因为：

1. **原有数据** (`data/metadata.csv`) 包含5张精心标注的图片，有完整的字段信息
2. **新增数据** 通过`npm run process-all`生成，包含124张图片但字段为"待标注"状态
3. **数据结构不匹配** 导致合并时出现NULL值

## ✅ 解决方案

### 1. 自动合并功能

现在`npm run process-all`会自动合并CSV数据：

```bash
npm run process-all
```

这将：
- ✅ 处理所有124张图片
- ✅ 保留原有5张图片的详细标注
- ✅ 为新图片添加"待标注"占位符
- ✅ 自动合并到`data/metadata.csv`
- ✅ 创建备份文件防止数据丢失

### 2. 手动合并功能

如果需要单独合并CSV数据：

```bash
npm run merge-csv
```

## 📋 CSV字段结构

### 完整字段列表

```csv
filename,book_title,style_tags,mood_tags,composition_tags,scene_tags,season_tags,content_tags,emotion_tags,theme_tags,text_type_fit,age_orientation,tone_tags,book_theme_summary,book_keywords
```

### 字段说明

| 字段名 | 说明 | 示例 |
|--------|------|------|
| `filename` | 图片文件名 | `88-清明节的故事.jpg` |
| `book_title` | 绘本名称 | `清明节的故事` |
| `style_tags` | 风格标签 | `水彩,童趣` |
| `mood_tags` | 情绪标签 | `温馨,热闹,宁静` |
| `composition_tags` | 构图标签 | `俯视构图` |
| `scene_tags` | 场景标签 | `夜晚室内,集体生活` |
| `season_tags` | 季节标签 | `秋` |
| `content_tags` | 内容标签 | `动物主角,床铺,灯光` |
| `emotion_tags` | 情感标签 | `宁静,温馨,安全感` |
| `theme_tags` | 主题标签 | `亲情,睡前仪式,自然` |
| `text_type_fit` | 文本类型 | `睡前故事,哲理短句` |
| `age_orientation` | 年龄定位 | `幼儿,小学低年级` |
| `tone_tags` | 语调标签 | `温柔,诗意,抚慰` |
| `book_theme_summary` | 绘本主题总结 | `描绘14只老鼠一家...` |
| `book_keywords` | 关键词 | `14只老鼠,家庭,睡前` |

## 🔧 数据状态

### 原有数据（已标注）
```csv
"01.jpg","14只老鼠的摇篮曲","水彩,童趣","温馨,热闹,宁静","俯视构图",...
"02.jpg","三个强盗","剪纸风,强烈色彩对比","紧张,神秘,惊险","侧面构图",...
```

### 新增数据（待标注）
```csv
"88-清明节的故事.jpg","清明节的故事","待标注","待标注","待标注",...
"109-菲菲生气了-1.jpg","菲菲生气了","待标注","待标注","待标注",...
```

## 📊 数据统计

运行合并后，您将看到：

```
📊 数据统计:
   总图片数: 124
   绘本数量: 102
   已标注图片: 5
   待标注图片: 119
```

## 🛠️ 数据完善建议

### 1. 优先级标注

建议按以下优先级完善数据：

1. **高频绘本** - 有多张图片的绘本优先标注
2. **代表性图片** - 每本绘本选择1-2张代表图片详细标注
3. **批量标注** - 相似风格的图片可以批量标注

### 2. 标注工具

可以使用以下方式编辑CSV：

- **Excel/WPS** - 适合批量编辑
- **VS Code** - 使用CSV插件，适合程序员
- **Google Sheets** - 在线协作标注

### 3. 标注模板

参考已标注的5张图片作为模板：

```csv
# 风格标签示例
"水彩,童趣" | "剪纸风,强烈色彩对比" | "拼贴风,手绘线条"

# 情绪标签示例  
"温馨,热闹,宁静" | "紧张,神秘,惊险" | "温馨,欢乐,节日感"

# 构图标签示例
"俯视构图" | "侧面构图" | "留白构图"
```

## 🔍 质量检查

### 1. 验证数据完整性

```bash
npm run verify
```

### 2. 检查绘本分组

```bash
npm run test-chinese
```

### 3. 查看统计信息

```bash
npm run merge-csv
```

## ⚠️ 注意事项

### 1. 数据备份

- 每次合并都会自动创建备份文件
- 备份文件格式：`metadata_backup_[timestamp].csv`
- 建议定期手动备份重要数据

### 2. 字段格式

- 多个标签用逗号分隔：`"标签1,标签2,标签3"`
- 包含逗号的内容用双引号包围
- 空字段保持为空，不要填写"NULL"

### 3. 绘本名称一致性

- 系统会自动从文件名提取绘本名称
- 确保同一绘本的多张图片名称一致
- 如需修改，建议批量替换

## 🚀 下一步行动

1. **运行处理** - 确保所有图片都已处理
   ```bash
   npm run process-all
   ```

2. **检查结果** - 验证数据合并效果
   ```bash
   npm run verify
   ```

3. **开始标注** - 打开`data/metadata.csv`开始手动标注

4. **定期备份** - 标注过程中定期保存和备份

---

## 📝 总结

现在您的CSV数据问题已经解决：
- ✅ 新旧数据正确合并
- ✅ 原有标注完整保留  
- ✅ 新图片字段结构完整
- ✅ 自动备份防止丢失
- ✅ 支持增量更新

您可以放心地继续处理更多图片，系统会自动维护数据的完整性和一致性！ 